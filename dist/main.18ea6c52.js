var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null==t?"":decodeURIComponent(t[1].replace(/\+/g," "))}let vid="";console.log("%cWelcome to StarKingdoms! Version: v0.3.1.2","color:blue");var username=getParameterByName("username");function setServerMsg(e){document.getElementById("content").innerHTML=e}function util_gethost(){return window.location.protocol.includes("file")?"http://localhost:8443":window.location.protocol+"//"+window.location.host+":8443"}canvas.width=window.innerWidth,canvas.height=window.innerHeight,window.onresize=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight},null!=username&&""!=username&&" "!=username||(username="Unnamed"),setServerMsg("Connecting...");var socket=io(util_gethost());socket.emit("join",username);var socketId,players={},player={x:0,y:0,rotation:90,velX:0,velY:0},keys={},usernames={},planets={},modules=[],mousePos={x:0,y:0},buttons=[];const SCALE=30;function chatMsg(e){socket.emit("message",e,username),console.log("%cSent chat message to server.","color:green")}function mkInlineImg(e){var t=new Image;return t.src=e,t.style="  \n\tdisplay: inline-block;\n\twidth: 250px;\n\theight: auto;\n\tvertical-align: top;\n\tborder: 3px solid #888;\n\tborder-radius: 5px;",t}function checkForImgUrl(e){return null!=e.match(/\.(jpeg|jpg|gif|png)$/)}socket.on("disallowed_ban",(function(e){setServerMsg("Connection failed: You have been banned from StarKingdoms. Reason: "+e);for(var t=window.setTimeout((function(){}),0);t--;)window.clearTimeout(t)})),socket.on("client-pos",(function(e,t,n){players=e,player.x=t.x,player.y=t.y,player.rotation=t.rotation,player.username=n[socketId],player.velX=t.velX,player.velY=t.velY,usernames=n})),socket.on("planet-pos",(e=>{planets=e})),socket.on("module-pos",(e=>{modules=e}));let chat=document.getElementById("chat");socket.on("message",((e,t)=>{if(checkForImgUrl(e)){let n=mkInlineImg(e);chat.innerHTML+="<b>"+t+"</b>: ",chat.appendChild(n)}else chat.innerHTML+=marked.parse(`**${t}**: ${e}`),chat.scrollTop=chat.scrollHeight;console.log("%cRevieved chat message from server.","color:green")})),socket.on("ready",(e=>{socketId=e,setServerMsg("Connected!"),setTimeout((function(){document.getElementById("srvmsg").style.display="hidden"}),2e3)}));var earth=new Image;earth.src="static/img/earth.png";var moon=new Image;moon.src="static/img/moon.png";var hearty=new Image;hearty.src="static/img/hearty.png";var cargo=new Image;cargo.src="static/img/cargo.png";var xPos=0,yPos=0,vel=0,canvasStr="0px 0px",newXPos=0,newYPos=0,newVel=0,newCanvasStr="0px 0px",rewritePos=!1,rewriteVel=!1,rewriteCanvasStr=!1,position=document.getElementById("position"),velocity=document.getElementById("velocity");function recalculatePositioning(){rewritePos=!1,rewriteVel=!1,rewriteCanvasStr=!1;var e=Math.round(player.x/50),t=Math.round(player.y/50),n=Math.round(Math.sqrt(player.velX*player.velX+player.velY*player.velY)),o=`${Math.trunc(-player.x/10)}px ${Math.trunc(-player.y/10)}px`;e!=xPos&&(rewritePos=!0,xPos=e),t!=yPos&&(rewritePos=!0,yPos=t),n!=vel&&(rewriteVel=!0,vel=n),rewritePos&&(position.innerHTML=`Position: ${xPos}, ${yPos}`),rewriteVel&&(velocity.innerHTML=`Vel: ${vel}`),canvas.style.backgroundPosition=o}var camX=0,camY=0;function draw(){setInterval((()=>{if(recalculatePositioning(),ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,0,canvas.width,canvas.height),camX=-player.x+canvas.width/2,camY=-player.y+canvas.height/2,ctx.translate(camX,camY),null!=planets.earth){for(var e of(ctx.drawImage(earth,-1250+planets.earth.x,-1250+planets.earth.y,2500,2500),ctx.drawImage(moon,-300+planets.moon.x,-300+planets.moon.y,600,600),ctx.beginPath(),ctx.strokeStyle="gray",ctx.lineWidth=5,ctx.moveTo(player.x,player.y),ctx.lineTo(planets.moon.x,planets.moon.y),ctx.stroke(),ctx.beginPath(),ctx.strokeStyle="limegreen",ctx.lineWidth=5,ctx.moveTo(player.x,player.y),ctx.lineTo(planets.earth.x,planets.earth.y),ctx.stroke(),Object.keys(players)))ctx.save(),ctx.translate(players[e].x,players[e].y),ctx.textAlign="center",ctx.font="30px Segoe UI",ctx.fillStyle="white",ctx.fillText(usernames[e],0,-35),ctx.rotate(players[e].rotation),ctx.drawImage(hearty,-25,-25,50,50),ctx.restore();for(let e=0;e<modules.length;e++)ctx.save(),ctx.translate(modules[e].x,modules[e].y),ctx.rotate(modules[e].rotation),ctx.drawImage(cargo,-25,-25,50,50),ctx.restore();socket.emit("input",keys,{x:mousePos.x+player.x-canvas.width/2,y:mousePos.y+player.y-canvas.height/2},buttons)}}),1e3/60)}draw(),document.onmousedown=e=>{buttons=e.buttons},document.onmouseup=e=>{buttons=e.buttons},document.onmousemove=e=>{mousePos={x:e.pageX,y:e.pageY}},document.onkeydown=e=>{document.activeElement!=document.getElementById("msg")&&(keys[e.key]=!0)},document.onkeyup=e=>{keys[e.key]=!1};
//# sourceMappingURL=main.18ea6c52.js.map

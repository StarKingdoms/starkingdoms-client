{"mappings":"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","sources":["static/scripts/client.js"],"sourcesContent":["var canvas = document.getElementById(\"canvas\");\nvar ctx = canvas.getContext('2d');\n\nfunction getParameterByName( name ){\n\tname = name.replace(/[\\[]/,\"\\\\\\[\").replace(/[\\]]/,\"\\\\\\]\");\n\tvar regexS = \"[\\\\?&]\"+name+\"=([^&#]*)\";\n\tvar regex = new RegExp(regexS);\n\tvar results = regex.exec(window.location.href);\n\tif(results == null) {\n\t\treturn \"\";\n\t} else {\n\t\treturn decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n\t} }\nlet vid = \"\";\n\nconsole.log(\"%cWelcome to StarKingdoms! Version: v0.3.1.2\", \"color:blue\");\n\nvar username = getParameterByName('username');\n\ncanvas.width = window.innerWidth;\ncanvas.height = window.innerHeight;\n\nwindow.onresize = function() {\n\tcanvas.width = window.innerWidth;\n\tcanvas.height = window.innerHeight;\n}\n\nif(username == undefined || username == \"\" || username == \" \") {\n\tusername = \"Unnamed\";\n}\n\nfunction setServerMsg(msg) {\n\tdocument.getElementById(\"content\").innerHTML = msg;\n}\n\nfunction util_gethost() {\n\tif (window.location.protocol.includes(\"file\")) {\n\t\treturn \"http://localhost:8443\";\n\t} else {\n\t\treturn window.location.protocol + \"//\" + window.location.host + \":8443\";\n\t}\n}\n\nsetServerMsg(\"Connecting...\");\n\nvar socket = io(util_gethost());\n\n/*var failConn = setTimeout(function() {\n        socket.disconnect();\n\tvar id = window.setTimeout(function() {}, 0);\n\nwhile (id--) {\n    window.clearTimeout(id); // will do nothing if no timeout with id is present\n}\n\tconsole.log(\"Connection aborted after 10 seconds\");\n\tsetServerMsg(\"Connection aborted: timeout\");\n}, 10000);*/\n\nsocket.emit(\"join\", username);\n/*var waitConn = setTimeout(function() {\n\tsocket.emit(\"join\", username);\n\tsetServerMsg(\"Having trouble connecting to server. Aborting in 8...\");\n\tsetTimeout(function(){setServerMsg(\"Having trouble connecting to server. Aborting in 7...\");socket.emit(\"join\", username, vid);},1000);\n\tsetTimeout(function(){setServerMsg(\"Having trouble connecting to server. Aborting in 6...\");socket.emit(\"join\", username, vid);},2000);\n\tsetTimeout(function(){setServerMsg(\"Having trouble connecting to server. Aborting in 5...\");socket.emit(\"join\", username, vid);},3000);\n\tsetTimeout(function(){setServerMsg(\"Having trouble connecting to server. Aborting in 4...\");socket.emit(\"join\", username, vid);},4000);\n\tsetTimeout(function(){setServerMsg(\"Having trouble connecting to server. Aborting in 3...\");socket.emit(\"join\", username, vid);},5000);\n\tsetTimeout(function(){setServerMsg(\"Having trouble connecting to server. Aborting in 2...\");socket.emit(\"join\", username, vid);},6000);\n\tsetTimeout(function(){setServerMsg(\"Having trouble connecting to server. Aborting in 1...\");socket.emit(\"join\", username, vid);},7000);\n}, 2000);*/\n\nvar players = {};\nvar player = {\n\tx: 0,\n\ty: 0,\n\trotation: 90,\n\tvelX: 0,\n\tvelY: 0\n};\nvar socketId;\n\nvar keys = {};\nvar usernames = {};\nvar planets = {};\nvar modules = [];\nvar mousePos = {\n    x: 0,\n    y: 0\n};\nvar buttons = [];\n\nconst SCALE = 30;\n\nfunction chatMsg(value) {\n\tsocket.emit(\"message\", value, username);\n\tconsole.log(\"%cSent chat message to server.\", \"color:green\");\n}\n\nfunction mkInlineImg(src) {\n\tvar img = new Image();\n\timg.src = src;\n\n\timg.style = `  \n\tdisplay: inline-block;\n\twidth: 250px;\n\theight: auto;\n\tvertical-align: top;\n\tborder: 3px solid #888;\n\tborder-radius: 5px;`;\n\n\treturn img;\n}\n\nfunction checkForImgUrl(url) {\n\treturn(url.match(/\\.(jpeg|jpg|gif|png)$/) != null);\n}\n\nsocket.on(\"disallowed_ban\", function(message){\n\tsetServerMsg(\"Connection failed: You have been banned from StarKingdoms. Reason: \" + message);\n\tvar id = window.setTimeout(function() {}, 0);\n\nwhile (id--) {\n    window.clearTimeout(id); // will do nothing if no timeout with id is present\n}\n});\n\nsocket.on(\"client-pos\", function(msg, thisPlayer, usernamesInfo){\n\tplayers = msg;\n\tplayer.x = thisPlayer.x;\n\tplayer.y = thisPlayer.y;\n\tplayer.rotation = thisPlayer.rotation;\n\tplayer.username = usernamesInfo[socketId];\n\tplayer.velX = thisPlayer.velX;\n\tplayer.velY = thisPlayer.velY;\n\tusernames = usernamesInfo;\n});\n\nsocket.on(\"planet-pos\", (planetInfo) => {\n\tplanets = planetInfo;\n})\n\nsocket.on(\"module-pos\", (moduleInfo) => {\n\tmodules = moduleInfo;\n});\n\nlet chat = document.getElementById(\"chat\");\n\nsocket.on(\"message\", (text, username) => {\n\tif (checkForImgUrl(text)) {\n\t\tlet img = mkInlineImg(text);\n\t\tchat.innerHTML += '<b>' + username + \"</b>: \";\n\t\tchat.appendChild(img);\n\t} else {\n\t\tchat.innerHTML += marked.parse(`**${username}**: ${text}`);\n\t\tchat.scrollTop = chat.scrollHeight;\n\t}\n\tconsole.log(\"%cRevieved chat message from server.\", \"color:green\");\n});\n\nsocket.on(\"ready\", (id) => {\n\t//clearTimeout(failConn);\n\t//clearTimeout(waitConn);\n    socketId = id;\n\tsetServerMsg(\"Connected!\");\n\tsetTimeout(function(){document.getElementById(\"srvmsg\").style.display=\"hidden\";},2000);\n});\n\nvar earth = new Image;\nearth.src = \"static/img/earth.png\"\n\nvar moon = new Image;\nmoon.src = \"static/img/moon.png\"\n\nvar hearty = new Image;\nhearty.src = \"static/img/hearty.png\"\n\nvar cargo = new Image;\ncargo.src = \"static/img/cargo.png\"\n\nvar xPos = 0;\nvar yPos = 0;\nvar vel = 0;\n\nvar canvasStr = '0px 0px';\n\nvar newXPos = 0;\nvar newYPos = 0;\nvar newVel = 0;\nvar newCanvasStr = '0px 0px';\n\nvar rewritePos = false;\nvar rewriteVel = false;\nvar rewriteCanvasStr = false;\n\nvar position = document.getElementById(\"position\");\nvar velocity = document.getElementById(\"velocity\");\n\nfunction recalculatePositioning() {\n\trewritePos = false;\n\trewriteVel = false;\n\trewriteCanvasStr = false;\n\tvar newXPos = Math.round(player.x / 50);\n\tvar newYPos = Math.round(player.y / 50);\n\tvar newVel = Math.round(Math.sqrt(player.velX * player.velX + player.velY * player.velY));\n\n\tvar newCanvasStr = `${Math.trunc(-player.x / 10)}px ${Math.trunc(-player.y / 10)}px`;\n\n\tif (newXPos != xPos) {\n\t\trewritePos = true;\n\t\txPos = newXPos;\n\t}\n\tif (newYPos != yPos) {\n\t\trewritePos = true;\n\t\tyPos = newYPos;\n\t}\n\tif (newVel != vel) {\n\t\trewriteVel = true;\n\t\tvel = newVel;\n\t}\n\tif (rewritePos) {\n\t\tposition.innerHTML = `Position: ${xPos}, ${yPos}`;\n\t}\n\tif (rewriteVel) {\n\t\tvelocity.innerHTML = `Vel: ${vel}`;\n\t}\n\tcanvas.style.backgroundPosition = newCanvasStr;\n}\n\nvar camX = 0;\nvar camY = 0;\n\nfunction draw() {\n\tlet intervalId = setInterval(() => {\n\n\t\trecalculatePositioning();\n\n\t\tctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\tctx.clearRect(0, 0, canvas.width, canvas.height);\n\n\t\tcamX = -player.x + canvas.width / 2\n\t\tcamY = -player.y + canvas.height / 2\n\t\tctx.translate(camX, camY);\n\n\t\tif (planets.earth == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tctx.drawImage(earth, -1250 + planets.earth.x, -1250 + planets.earth.y, 2500, 2500)\n\n\t\tctx.drawImage(moon, -300 + planets.moon.x, -300 + planets.moon.y, 600, 600);\n\n\t\tctx.beginPath();\n\t\tctx.strokeStyle = \"gray\";\n\t\tctx.lineWidth = 5;\n\t\tctx.moveTo(player.x, player.y);\n\t\tctx.lineTo(planets.moon.x, planets.moon.y);\n\t\tctx.stroke();\n\n\t\tctx.beginPath();\n\t\tctx.strokeStyle = \"limegreen\";\n\t\tctx.lineWidth = 5;\n\t\tctx.moveTo(player.x, player.y);\n\t\tctx.lineTo(planets.earth.x, planets.earth.y)\n\t\tctx.stroke();\n\n\t\tfor(var key of Object.keys(players)) {\n\t\t\tctx.save();\n\t\t\tctx.translate(players[key].x,\n                players[key].y);\n\n\t\t\tctx.textAlign = \"center\";\n\t\t\tctx.font = '30px Segoe UI';\n\t\t\tctx.fillStyle = \"white\";\n\t\t\tctx.fillText(usernames[key], 0, -35);\n\n\t\t\tctx.rotate(players[key].rotation);\n\t\t\tctx.drawImage(hearty, -25, -25, 50, 50);\n\t\t\tctx.restore();\n\t\t}\n\n\t\tfor(let i = 0; i < modules.length; i++) {\n\t\t\tctx.save();\n\t\t\tctx.translate(modules[i].x, modules[i].y)\n\t\t\tctx.rotate(modules[i].rotation);\n\t\t\tctx.drawImage(cargo, -25, -25, 50, 50) \n\t\t\tctx.restore();\n\t\t}\n\t\tsocket.emit(\"input\", keys, {\n            x:mousePos.x + player.x - canvas.width / 2,\n            y:mousePos.y + player.y - canvas.height / 2\n        }, buttons);\n\t}, 1000/60);\n}\n\ndraw();\n\ndocument.onmousedown = (e) => {\n    buttons = e.buttons\n}\ndocument.onmouseup = (e) => {\n    buttons = e.buttons\n}\n\ndocument.onmousemove = (e) => {\n    mousePos = {\n        x: e.pageX,\n        y: e.pageY \n    }\n}\n\ndocument.onkeydown = (e) => {\n\tif(document.activeElement != document.getElementById('msg')) {\n\t\tkeys[e.key] = true\n\t}\n}\n\ndocument.onkeyup = (e) => {\n\tkeys[e.key] = false;\n};\n"],"names":["canvas","document","getElementById","ctx","getContext","getParameterByName","name","replace","results","RegExp","exec","window","location","href","decodeURIComponent","vid","console","log","username","setServerMsg","msg","innerHTML","util_gethost","protocol","includes","host","width","innerWidth","height","innerHeight","onresize","undefined","socket","io","emit","socketId","players","player","x","y","rotation","velX","velY","keys","usernames","planets","modules","mousePos","buttons","SCALE","chatMsg","value","mkInlineImg","src","img","Image","style","checkForImgUrl","url","match","on","message","id","setTimeout","clearTimeout","thisPlayer","usernamesInfo","planetInfo","moduleInfo","chat","text","username1","appendChild","marked","parse","scrollTop","scrollHeight","display","earth","moon","hearty","cargo","xPos","yPos","vel","canvasStr","newXPos","newYPos","newVel","newCanvasStr","rewritePos","rewriteVel","rewriteCanvasStr","position","velocity","recalculatePositioning","newXPos1","Math","round","newYPos1","newVel1","sqrt","newCanvasStr1","trunc","backgroundPosition","camX","camY","draw","setInterval","setTransform","clearRect","translate","key","drawImage","beginPath","strokeStyle","lineWidth","moveTo","lineTo","stroke","Object","save","textAlign","font","fillStyle","fillText","rotate","restore","i","length","onmousedown","e","onmouseup","onmousemove","pageX","pageY","onkeydown","activeElement","onkeyup"],"version":3,"file":"main.18ea6c52.js.map"}